<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© Ø¨Ø³ Ù…Ø§ Ø£Ø¯Ø±ÙŠ â€” Ù„Ø¹Ø¨Ø© Ø­ÙÙ„Ø§Øª</title>
  <style>
    :root{
      --bg:#0e1013;--card:#151922;--muted:#8b93a7;--text:#e9eef7;--accent:#6ee7b7;--accent2:#60a5fa;--danger:#f87171;--warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0e12,#10131a 40%,#0b0e12);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:980px;margin:0 auto;padding:20px}
    h1,h2,h3{margin:0 0 12px}
    h1{font-size:28px}
    h2{font-size:22px}
    p{color:var(--muted)}
    .card{background:var(--card);border:1px solid #1f2531;border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 240px}
    label{display:block;margin-bottom:6px;color:#c6d3eb;font-size:14px}
    input,select,textarea,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #263044;background:#0f1420;color:var(--text);outline:none}
    input:focus,select:focus,textarea:focus{border-color:var(--accent2)}
    button{cursor:pointer;background:linear-gradient(135deg,var(--accent2),#7dd3fc);border:none;font-weight:700}
    button.secondary{background:#1b2334;border:1px solid #2a3550}
    button.ghost{background:transparent;border:1px dashed #33415f}
    button.danger{background:linear-gradient(135deg,#ef4444,#fb7185)}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#1d283a;border:1px solid #2a3550;color:#cfe0ff;font-size:12px}
    .list{display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:8px 12px;border-radius:999px;border:1px solid #2a3550;background:#131a28}
    .hidden{display:none}
    .center{text-align:center}
    .grid{display:grid;gap:10px}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .muted{color:var(--muted)}
    .title{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .title .logo{width:38px;height:38px;display:grid;place-items:center;border-radius:12px;background:linear-gradient(135deg,var(--accent2),#34d399);font-weight:900}
    .hr{height:1px;background:#222a39;margin:14px 0}
    .footer{opacity:.7;font-size:12px}
    .big{font-size:20px}
    .word-flash{font-weight:800;font-size:34px;letter-spacing:1px;background:linear-gradient(90deg,#93c5fd,#34d399);-webkit-background-clip:text;background-clip:text;color:transparent}
    .stack{display:flex;flex-direction:column;gap:10px}
    .vote-item{display:flex;align-items:center;gap:8px}
    .score{display:flex;align-items:center;justify-content:space-between;padding:10px;border:1px solid #2a3550;border-radius:12px;background:#121828}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#0d1220;border:1px solid #2a3550;border-bottom-width:3px;border-radius:8px;padding:3px 6px}
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <div class="logo">ğŸ•µï¸</div>
      <div>
        <h1>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©.. Ø¨Ø³ Ù…Ø§ Ø£Ø¯Ø±ÙŠ!</h1>
        <p class="muted">Ù„Ø¹Ø¨Ø© Ø­ÙÙ„Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©: ÙˆØ§Ø­Ø¯ Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„Ø¨Ù‚ÙŠØ© â€” ÙˆÙ…Ø§ ÙŠØ¯Ø±ÙŠ Ø¥Ù†Ù‡ Ù…Ø®ØªÙ„Ù ğŸ‘€</p>
      </div>
    </div><!-- SETUP CARD -->
<div id="view-setup" class="card">
  <h2>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø©</h2>
  <div class="row">
    <div class="col">
      <label>Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ù… Ø¨ÙØ§ØµÙ„Ø© ØŒ)</label>
      <input id="playersInput" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø§ØµØ±ØŒ Ø´Ù‡Ø¯ØŒ ÙÙŠØµÙ„ØŒ Ø±Ù‡ÙØŒ ÙŠÙˆØ³Ù">
    </div>
    <div class="col">
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØµÙˆÙŠØª</label>
      <select id="questionCount">
        <option value="4">4</option>
        <option value="6" selected>6</option>
        <option value="8">8</option>
      </select>
    </div>
  </div>

  <div class="hr"></div>
  <div class="row">
    <div class="col">
      <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ</label>
      <select id="categorySelect"></select>
    </div>
    <div class="col">
      <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</label>
      <select id="pairMode">
        <option value="random" selected>Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† Ø§Ù„ØªØµÙ†ÙŠÙ</option>
        <option value="manual">Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ Ù„Ù„ÙƒÙ„Ù…Ø©/Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</option>
      </select>
    </div>
  </div>

  <div id="manualPairs" class="row hidden">
    <div class="col">
      <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ù„Ø£ØºÙ„Ø¨ÙŠØ©)</label>
      <input id="baseWord" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ù‡ÙˆØ©">
    </div>
    <div class="col">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø®ØªÙ„Ù (Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)</label>
      <input id="oddWord" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§ÙŠ">
    </div>
  </div>

  <div class="hr"></div>
  <div class="row">
    <div class="col">
      <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
    </div>
    <div class="col">
      <button class="secondary" id="demoBtn">ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© (Ø£Ø³Ù…Ø§Ø¡ ÙˆÙ‡Ù…ÙŠØ©)</button>
    </div>
  </div>

  <p class="footer">Ù†ØµÙŠØ­Ø©: Ø§Ø¬Ù„Ø³ÙˆØ§ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø¨Ø¹Ø¶ ÙˆØªØ¨Ø§Ø¯Ù„ÙˆØ§ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Ù…Ø±Ø­Ù„Ø© â€œØ¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø©â€. Ù„Ø§ Ø£Ø­Ø¯ ÙŠØªØ¬Ø³Ø³ ğŸ˜†</p>
</div>

<!-- REVEAL CARD -->
<div id="view-reveal" class="card hidden">
  <h2>Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨</h2>
  <p class="muted">Ù…Ø±Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù…Ù‡ Ù„ÙŠØ´ÙˆÙ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„Ø«ÙˆØ§Ù†Ù.</p>
  <div id="revealList" class="grid grid-2"></div>
  <div class="hr"></div>
  <div class="row">
    <button class="secondary" id="backToSetup">Ø±Ø¬ÙˆØ¹</button>
    <button id="beginQuestions">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</button>
  </div>
</div>

<!-- QUESTIONS CARD -->
<div id="view-questions" class="card hidden">
  <div class="row" style="align-items:center;justify-content:space-between">
    <h2>Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© <span class="badge" id="qProgress">0/0</span></h2>
    <div class="badge" id="currentCategory">ØªØµÙ†ÙŠÙ</div>
  </div>
  <div class="hr"></div>
  <div class="grid">
    <div class="card" style="background:#101625;border-color:#222c44">
      <div class="big">Ø³Ø¤Ø§Ù„:</div>
      <div id="questionText" class="word-flash" style="margin:6px 0 10px">â€¦</div>
      <div class="muted">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰: <span id="turnName" class="badge"></span></div>
    </div>
    <div class="row">
      <button id="nextQuestion">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
      <button class="secondary" id="goVote">Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØµÙˆÙŠØª</button>
    </div>
  </div>
  <p class="footer">ØªÙ„Ù…ÙŠØ­: Ø§Ø³Ø£Ù„ÙˆØ§ Ø£Ø³Ø¦Ù„Ø© ØªÙƒØ´Ù Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©. Ù…Ø«Ø§Ù„: â€œÙ‡Ù„ ØªØªÙ‚Ø¯Ù… Ø­Ù„ÙˆØ© Ø£Ù… Ù…Ø§Ù„Ø­Ø©ØŸâ€</p>
</div>

<!-- VOTE CARD -->
<div id="view-vote" class="card hidden">
  <h2>Ø§Ù„ØªØµÙˆÙŠØª: Ù…ÙŠÙ† Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©ØŸ</h2>
  <div id="voteArea" class="stack"></div>
  <div class="hr"></div>
  <div class="row">
    <button class="secondary" id="backToQuestions">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ø³Ø¦Ù„Ø©</button>
    <button id="submitVotes">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØµÙˆÙŠØª</button>
  </div>
</div>

<!-- RESULT CARD -->
<div id="view-result" class="card hidden">
  <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
  <div id="resultSummary" class="grid"></div>
  <div class="hr"></div>
  <div class="row">
    <button class="ghost" id="newRoundSame">Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†)</button>
    <button id="newRoundReset">Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø¯ÙŠØ¯</button>
  </div>
</div>

<!-- SCOREBOARD -->
<div id="view-score" class="card hidden">
  <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø©</h2>
  <div id="scoreList" class="stack"></div>
</div>

  </div>  <script>
  // ===== Data Packs (ØªØµÙ†ÙŠÙØ§Øª + Ø£Ø²ÙˆØ§Ø¬ ÙƒÙ„Ù…Ø§Øª Ù‚Ø±ÙŠØ¨Ø©) =====
  const PACKS = {
    "Ø£ÙƒÙ„Ø§Øª ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª": [
      ["Ø¨ÙŠØªØ²Ø§","Ø¨Ø±Ø¬Ø±"],["Ø´Ø§ÙˆØ±Ù…Ø§","ÙØ§Ù‡ÙŠØªØ§"],["Ù‚Ù‡ÙˆØ©","Ø´Ø§ÙŠ"],["Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„","Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ"],["ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ","Ù„Ø§ØªÙŠÙ‡"],["Ø±Ø²","Ù…ÙƒØ±ÙˆÙ†Ø©"],["ÙØ·ÙˆØ±","Ø¹Ø´Ø§Ø¡"],["ÙƒØ¹Ùƒ","Ø¯ÙˆÙ†Ø§Øª"],["Ù…Ø§Ø¡ ØºØ§Ø²ÙŠ","Ø¹ØµÙŠØ± ØºØ§Ø²ÙŠ"],["ÙÙˆÙ„","Ø­Ù…Øµ"]
    ],
    "Ø£Ù…Ø§ÙƒÙ† ÙˆÙ…Ø¯Ù†": [
      ["Ø¨Ø§Ø±ÙŠØ³","Ù„Ù†Ø¯Ù†"],["Ù…ÙƒØ©","Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"],["Ø·ÙˆÙƒÙŠÙˆ","Ø³ÙˆÙ„"],["Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±","Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¹Ø±Ø¨ÙŠ"],["Ø§Ù„Ø±ÙŠØ§Ø¶","Ø¬Ø¯Ø©"],["Ø§Ù„Ù‡Ø±Ù…","Ø£Ø¨Ùˆ Ø§Ù„Ù‡ÙˆÙ„"],["Ø§Ù„ØµØ­Ø±Ø§Ø¡","Ø§Ù„ÙˆØ§Ø­Ø©"],["Ø´Ø§Ø·Ø¦","Ù…Ø³Ø¨Ø­"],["Ø¬Ø§Ù…Ø¹Ø©","Ù…Ø¯Ø±Ø³Ø©"],["Ù…Ø³ØªØ´ÙÙ‰","Ø¹ÙŠØ§Ø¯Ø©"]
    ],
    "Ø£Ø´ÙŠØ§Ø¡ ÙŠÙˆÙ…ÙŠØ©": [
      ["Ø¬ÙˆØ§Ù„","ØªØ§Ø¨Ù„Øª"],["Ù…ÙƒÙŠÙ","Ù…Ø±ÙˆØ­Ø©"],["Ù‚Ù„Ù…","Ù…Ø§Ø±ÙƒØ±"],["ÙƒØ±Ø³ÙŠ","Ø£Ø±ÙŠÙƒØ©"],["Ø±ÙŠÙ…ÙˆØª","ÙŠØ¯ ØªØ­ÙƒÙ…"],["Ø³Ù…Ø§Ø¹Ø§Øª","Ø³Ø¨ÙŠÙƒØ±"],["Ø­Ø§Ø³ÙˆØ¨ Ù…Ø­Ù…ÙˆÙ„","Ø­Ø§Ø³ÙˆØ¨ Ù…ÙƒØªØ¨ÙŠ"],["Ù…ØµØ¨Ø§Ø­","Ø´Ù…Ø¹Ø©"],["Ø³Ø§Ø¹Ø© ÙŠØ¯","Ø³ÙˆØ§Ø± Ø°ÙƒÙŠ"],["Ø¯Ø±Ø§Ø¬Ø©","Ø³ÙƒÙˆØªØ±"]
    ],
    "ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§/Ù…ÙØ§Ù‡ÙŠÙ…": [
      ["Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ","ØªØ¹Ù„Ù… Ø¢Ù„ÙŠ"],["Ø°Ø§ÙƒØ±Ø©","ØªØ®Ø²ÙŠÙ†"],["ÙˆØ§ÙŠ ÙØ§ÙŠ","Ø¨Ù„ÙˆØªÙˆØ«"],["ØªØ·Ø¨ÙŠÙ‚","Ù…ÙˆÙ‚Ø¹"],["ØªØ´ÙÙŠØ±","ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ±"],["Ø±ÙˆØ¨ÙˆØª","Ø·Ø§Ø¨Ø¹Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯"],["Ù†Ø¸Ø§Ù… Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯","iOS"],["ÙˆØ§Ù‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ","ÙˆØ§Ù‚Ø¹ Ù…Ø¹Ø²Ø²"],["Ø³Ø­Ø§Ø¨Ø©","Ø³ÙŠØ±ÙØ±"],["Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­","ÙØ£Ø±Ø©"]
    ],
    "Ù…Ø´Ø§Ø¹Ø± ÙˆÙ…ÙØ§Ù‡ÙŠÙ…": [
      ["ÙØ±Ø­","Ø­Ù…Ø§Ø³"],["Ø­Ø²Ù†","Ø¥Ø­Ø¨Ø§Ø·"],["Ø®ÙˆÙ","Ù‚Ù„Ù‚"],["Ø«Ù‚Ø©","ØºØ±ÙˆØ±"],["ØµØ¯Ù‚","Ù…Ø¬Ø§Ù…Ù„Ø©"],["Ø­Ø¸","Ø§Ø¬ØªÙ‡Ø§Ø¯"],["Ù‡Ø¯ÙˆØ¡","Ø³ÙƒÙŠÙ†Ø©"],["ØºØ¶Ø¨","Ø§Ù†ÙØ¹Ø§Ù„"],["Ø­Ø¨","Ø¥Ø¹Ø¬Ø§Ø¨"],["Ù…Ù„Ù„","ÙƒØ³Ù„"]
    ]
  };

  const QUESTIONS = [
    "Ù‡Ù„ ÙŠÙØ³ØªØ®Ø¯Ù… ØºØ§Ù„Ø¨Ù‹Ø§ ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ØŸ",
    "Ù‡Ù„ Ù‡Ùˆ Ø­Ù„Ùˆ Ø¹Ø§Ø¯Ø©Ù‹ØŸ",
    "Ù‡Ù„ ÙŠÙØ¤ÙƒÙ„/ÙŠÙØ´Ø±Ø¨ Ø³Ø§Ø®Ù†Ù‹Ø§ØŸ",
    "Ù‡Ù„ Ù„ÙˆÙ†Ù‡ ØºØ§Ù…Ù‚ØŸ",
    "Ù‡Ù„ ØªØ¬Ø¯Ù‡ ØºØ§Ù„Ø¨Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„ØŸ",
    "Ù‡Ù„ ÙŠÙØ³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙŠØ¯ Ù…Ø¨Ø§Ø´Ø±Ø©ØŸ",
    "Ù‡Ù„ Ù‡Ùˆ Ù…Ø±ØªØ¨Ø· Ø¨Ù…ÙƒØ§Ù† Ù…Ø­Ø¯Ø¯ØŸ",
    "Ù‡Ù„ ÙŠÙØµØ¯Ø± ØµÙˆØªÙ‹Ø§ØŸ",
    "Ù‡Ù„ Ø­Ø¬Ù…Ù‡ Ø¹Ø§Ø¯Ø© ØµØºÙŠØ±ØŸ",
    "Ù‡Ù„ ÙŠÙØ¨Ø§Ø¹ ØºØ§Ù„Ø¨Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…ØªØ®ØµØµØ©ØŸ",
    "Ù‡Ù„ ØªØ­ØªØ§Ø¬ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ù„ØªØ³ØªØ¹Ù…Ù„Ù‡ØŸ",
    "Ù‡Ù„ Ù‡Ùˆ Ø´ÙŠØ¡ ÙŠÙ…ÙƒÙ† Ø­Ù…Ù„Ù‡ Ù…Ø¹ÙƒØŸ",
    "Ù‡Ù„ ÙŠÙØ¹ØªØ¨Ø± ØµØ­ÙŠÙ‹Ø§ ØºØ§Ù„Ø¨Ù‹Ø§ØŸ",
    "Ù‡Ù„ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§ØªØŸ",
    "Ù‡Ù„ Ù„Ù‡ Ø±Ø§Ø¦Ø­Ø© Ù…Ù…ÙŠØ²Ø©ØŸ"
  ];

  // ===== State =====
  let state = {
    players: [],
    scores: {},
    category: null,
    pair: null, // {base, odd}
    oddIndex: null,
    reveals: {},
    turnOrder: [],
    asked: 0,
    maxQuestions: 6,
    usedQuestions: new Set(),
    votes: {},
  };

  // ===== Helpers =====
  const $ = sel => document.querySelector(sel);
  const el = (tag, cls, html) => {const e=document.createElement(tag); if(cls) e.className=cls; if(html!==undefined) e.innerHTML=html; return e;};
  const shuffle = (arr)=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
  const choice = (arr)=>arr[Math.floor(Math.random()*arr.length)];

  function saveScores(){ localStorage.setItem("bsb_scores", JSON.stringify(state.scores)); }
  function loadScores(){ const s=localStorage.getItem("bsb_scores"); if(s) state.scores = JSON.parse(s); }
  function renderScores(){ const box = $("#scoreList"); box.innerHTML=''; const items = Object.entries(state.scores).sort((a,b)=>b[1]-a[1]); items.forEach(([name,pts])=>{ box.appendChild(el('div','score',`<strong>${name}</strong><span>${pts} Ù†Ù‚Ø·Ø©</span>`)); }); $("#view-score").classList.toggle('hidden', items.length===0); }

  function setView(id){ ["#view-setup","#view-reveal","#view-questions","#view-vote","#view-result"].forEach(s=>$(s).classList.add('hidden')); $(id).classList.remove('hidden'); }

  // ===== Setup UI Init =====
  const catSel = $("#categorySelect");
  Object.keys(PACKS).forEach(k=>{ const o=document.createElement('option'); o.value=k;o.textContent=k; catSel.appendChild(o);});

  $("#pairMode").addEventListener('change', e=>{
    $("#manualPairs").classList.toggle('hidden', e.target.value!=="manual");
  });

  $("#demoBtn").addEventListener('click', ()=>{
    $("#playersInput").value = 'Ù†Ø§ØµØ±ØŒ Ø´Ù‡Ø¯ØŒ ÙÙŠØµÙ„ØŒ Ø±Ù‡ÙØŒ ÙŠÙˆØ³Ù';
  });

  $("#startBtn").addEventListener('click', ()=>{
    const raw = $("#playersInput").value.trim();
    const names = raw.split(/[ØŒ,]/).map(s=>s.trim()).filter(Boolean);
    if(names.length < 3){ alert('Ù„Ø§Ø²Ù… 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ âœ‹'); return; }

    state.players = names;
    $("#questionCount").value && (state.maxQuestions = parseInt($("#questionCount").value,10));

    state.category = $("#categorySelect").value;

    let base, odd;
    if($("#pairMode").value === 'manual'){
      base = $("#baseWord").value.trim();
      odd = $("#oddWord").value.trim();
      if(!base || !odd){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„ÙƒÙ„Ù…ØªÙŠÙ† Ù…Ù† ÙØ¶Ù„Ùƒ'); return; }
    } else {
      const p = choice(PACKS[state.category]);
      [base, odd] = Math.random() < .5 ? p : [p[1], p[0]]; // Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¯Ù‘Ù„
    }

    state.pair = {base, odd};
    state.oddIndex = Math.floor(Math.random()*state.players.length);
    state.reveals = {}; state.turnOrder = shuffle([...state.players]);
    state.asked = 0; state.usedQuestions = new Set(); state.votes = {};

    // Init scores if needed
    loadScores();
    state.players.forEach(n=>{ if(!(n in state.scores)) state.scores[n]=0; });
    renderScores();

    buildRevealList();
    setView('#view-reveal');
  });

  $("#backToSetup").addEventListener('click', ()=> setView('#view-setup'));

  function buildRevealList(){
    const box = $("#revealList"); box.innerHTML='';
    state.players.forEach((name, idx)=>{
      const item = el('div','card'); item.style.background='#101625'; item.style.borderColor='#1e2636';
      const b = el('button'); b.textContent = `ğŸ‘ï¸â€ğŸ—¨ï¸ ${name} â€” Ø§Ø¶ØºØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø©`;
      b.addEventListener('click', ()=>showWord(name, idx, b, item));
      item.appendChild(b);
      box.appendChild(item);
    });
  }

  function showWord(name, idx, btn, item){
    const isOdd = idx === state.oddIndex;
    const word = isOdd ? state.pair.odd : state.pair.base;
    btn.disabled = true; btn.classList.add('secondary');
    const w = el('div','word-flash center', word);
    const note = el('div','muted center', 'Ø³ÙŠØ®ØªÙÙŠ Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù');
    item.appendChild(w); item.appendChild(note);
    setTimeout(()=>{ w.remove(); note.remove(); btn.textContent = `âœ… ${name} â€” ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©`; }, 3000);
    state.reveals[name] = true;
  }

  $("#beginQuestions").addEventListener('click', ()=>{
    // Ensure all saw their word (optional)
    const unseen = state.players.filter(n=>!state.reveals[n]);
    if(unseen.length){ if(!confirm('Ø¨Ø¹Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø§ Ø´Ø§ÙÙˆØ§ ÙƒÙ„Ù…ØªÙ‡Ù…. ØªØ¨Ø¯Ø£ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„ØŸ')) return; }
    $("#currentCategory").textContent = state.category;
    updateQuestionUI();
    setView('#view-questions');
  });

  function updateQuestionUI(){
    $("#qProgress").textContent = `${state.asked}/${state.maxQuestions}`;
    const q = nextQuestion();
    $("#questionText").textContent = q;
    const turn = state.turnOrder[state.asked % state.players.length];
    $("#turnName").textContent = turn;
  }

  function nextQuestion(){
    let q;
    const available = QUESTIONS.filter(x=>!state.usedQuestions.has(x));
    if(!available.length){ state.usedQuestions.clear(); }
    do { q = choice(QUESTIONS); } while(state.usedQuestions.has(q));
    state.usedQuestions.add(q);
    return q;
  }

  $("#nextQuestion").addEventListener('click', ()=>{
    if(state.asked+1 >= state.maxQuestions){ alert('Ø¨Ù„ØºØª Ø­Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©. Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ØªØµÙˆÙŠØª.'); return; }
    state.asked++;
    // Randomize next turn order slightly
    if(Math.random()<0.4) state.turnOrder = shuffle(state.turnOrder);
    updateQuestionUI();
  });

  $("#goVote").addEventListener('click', ()=>{
    buildVoteUI();
    setView('#view-vote');
  });

  $("#backToQuestions").addEventListener('click', ()=> setView('#view-questions'));

  function buildVoteUI(){
    const area = $("#voteArea"); area.innerHTML='';
    state.votes = {};
    state.players.forEach(voter=>{
      const row = el('div','vote-item');
      const sel = document.createElement('select');
      sel.innerHTML = `<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´ÙƒÙˆÙƒ</option>` + state.players.map((p,i)=>`<option value="${i}" ${p===voter?'disabled':''}>${p}</option>`).join('');
      sel.addEventListener('change', ()=>{ state.votes[voter] = parseInt(sel.value,10); });
      row.appendChild(el('div',null,`<span class="badge">${voter}</span>`));
      row.appendChild(sel);
      area.appendChild(row);
    });
  }

  $("#submitVotes").addEventListener('click', ()=>{
    // Ensure all voted
    const missing = state.players.filter(p=>!(p in state.votes));
    if(missing.length){ alert('Ù„Ø³Ù‡ Ù…Ø§ ØµÙˆÙ‘Øª Ø§Ù„Ø¬Ù…ÙŠØ¹.'); return; }

    // Count votes
    const tally = new Array(state.players.length).fill(0);
    Object.values(state.votes).forEach(idx=>{ if(Number.isInteger(idx)) tally[idx]++; });

    const most = Math.max(...tally);
    const suspects = tally.map((c,i)=>[c,i]).filter(([c])=>c===most).map(([,i])=>i);

    const caught = suspects.includes(state.oddIndex); // Ù‡Ù„ ØªÙ… Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¨Ø§Ù„Ù…Ø®ØªÙ„ÙØŸ

    // Scoring
    // odd wins +3 if not caught, else 0; correct voters +1; wrong -1
    const oddName = state.players[state.oddIndex];
    if(caught){
      state.scores[oddName] += 0;
    } else {
      state.scores[oddName] += 3;
    }

    for(const [voter, idx] of Object.entries(state.votes)){
      if(idx === state.oddIndex && caught){ state.scores[voter] += 1; }
      else if(idx !== state.oddIndex){ state.scores[voter] -= 1; }
    }

    saveScores(); renderScores();
    showResult(tally, suspects, caught);
    setView('#view-result');
  });

  function showResult(tally, suspects, caught){
    const box = $("#resultSummary"); box.innerHTML='';
    const oddName = state.players[state.oddIndex];

    const a = el('div','card', `
      <div class="big">Ø§Ù„Ù…Ø®ØªÙ„Ù ÙƒØ§Ù†: <strong>${oddName}</strong></div>
      <div class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ØºÙ„Ø¨ÙŠØ©: <span class="badge">${state.pair.base}</span></div>
      <div class="muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø®ØªÙ„Ù: <span class="badge">${state.pair.odd}</span></div>
      <div class="hr"></div>
      <div>${caught ? 'ğŸ‘ ØªÙ… ÙƒØ´Ù Ø§Ù„Ù…Ø®ØªÙ„Ù â€” Ù†Ù‚Ø·Ø© (+1) Ù„ÙƒÙ„ Ù…Ù† ØµÙˆÙ‘Øª Ø¹Ù„ÙŠÙ‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­' : 'ğŸ˜ Ù…Ø§ Ø£Ø­Ø¯ ÙƒØ´Ù Ø§Ù„Ù…Ø®ØªÙ„Ù â€” ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ (+3) Ù†Ù‚Ø§Ø·'}</div>
    `);

    const b = el('div','card');
    b.innerHTML = `<h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</h3>`;
    const ul = el('div','stack');
    state.players.forEach((p,i)=>{
      const voters = Object.entries(state.votes).filter(([,idx])=>idx===i).map(([name])=>name);
      ul.appendChild(el('div',null,`<span class="badge">${p}</span> â€” ${tally[i]} ØµÙˆØª${tally[i]!==1?'': ''} ${voters.length?`<span class="muted">(${voters.join('ØŒ ')})</span>`:''}`));
    });
    b.appendChild(ul);

    const c = el('div','card');
    c.innerHTML = `<h3>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>`;
    const rank = el('div','stack');
    Object.entries(state.scores).sort((a,b)=>b[1]-a[1]).forEach(([n,s])=>{
      rank.appendChild(el('div','score',`<strong>${n}</strong><span>${s} Ù†Ù‚Ø·Ø©</span>`));
    });
    c.appendChild(rank);

    box.appendChild(a); box.appendChild(b); box.appendChild(c);
  }

  $("#newRoundSame").addEventListener('click', ()=>{
    // keep players & scores, reset round
    state.category = $("#categorySelect").value;
    const p = choice(PACKS[state.category]);
    const [base, odd] = Math.random()<.5? p : [p[1], p[0]];
    state.pair = {base, odd};
    state.oddIndex = Math.floor(Math.random()*state.players.length);
    state.reveals = {}; state.turnOrder = shuffle([...state.players]);
    state.asked = 0; state.usedQuestions = new Set(); state.votes = {};
    buildRevealList();
    setView('#view-reveal');
  });

  $("#newRoundReset").addEventListener('click', ()=>{
    setView('#view-setup');
  });

  // initial
  loadScores(); renderScores();
  </script></body>
</html>
